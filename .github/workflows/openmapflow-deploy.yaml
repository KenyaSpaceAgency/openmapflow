<<<<<<< HEAD
=======
################################################################################
# AUTOGENERATED using openmapflow generate
################################################################################
>>>>>>> 7f129cbf (refactored azure code)
name: openmapflow-deploy

on:
  push:
    branches: [ main ]
    paths: 'data/models.dvc'

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.9

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Log in to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Install Azure CLI and ML extension
        run: |
          az upgrade --yes
          az extension add --name ml

      - name: Set up DVC
        uses: iterative/setup-dvc@v1

      - name: Configure DVC for Azure Blob Storage
        run: dvc remote modify azure-remote account_name ${{ secrets.AZURE_STORAGE_ACCOUNT }}

      - name: Pull Latest Model from DVC
        run: dvc pull data/models.dvc

      - name: Deploy Model to Azure Machine Learning
        run: |
          az ml model create --name openmapflow-model --path ./data/models --workspace-name ${{ secrets.AZURE_ML_WORKSPACE }} --resource-group ${{ secrets.AZURE_RESOURCE_GROUP }}

      - name: Deploy Model as Azure ML Endpoint
        run: |
          az ml online-endpoint create --name openmapflow-endpoint --file endpoint.yml --workspace-name ${{ secrets.AZURE_ML_WORKSPACE }} --resource-group ${{ secrets.AZURE_RESOURCE_GROUP }}
<<<<<<< HEAD

=======
>>>>>>> 7f129cbf (refactored azure code)
